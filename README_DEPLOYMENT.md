# ğŸš€ ChainReactions Backend - DigitalOceanéƒ¨ç½²æŒ‡å—

> **ä»å•ä½“æ¶æ„å‡çº§åˆ°å¾®æœåŠ¡æ¶æ„çš„å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆ**

---

## ğŸ“‹ éƒ¨ç½²å‰å¿…è¯»

### å½“å‰çŠ¶æ€
- **æœåŠ¡å™¨ç¯å¢ƒ**: DigitalOcean Docker
- **æ—§æ¶æ„**: å•ä½“åº”ç”¨ (ç«¯å£3000)
- **æ–°æ¶æ„**: 5ä¸ªå¾®æœåŠ¡ + Redis (ç«¯å£3002-3006 + 6379)
- **éƒ¨ç½²ç­–ç•¥**: ç›´æ¥æ›¿æ¢ (é¢„è®¡åœæœº2-5åˆ†é’Ÿ)

### æ¶æ„å¯¹æ¯”

| ç»´åº¦ | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ |
|------|--------|--------|
| **æœåŠ¡æ•°é‡** | 1ä¸ªå•ä½“åº”ç”¨ | 5ä¸ªå¾®æœåŠ¡ + Redis |
| **ç«¯å£** | 3000 | 3002-3006, 6379 |
| **å¯æ‰©å±•æ€§** | ä½ | é«˜ (ç‹¬ç«‹æ‰©å±•) |
| **å®¹é”™æ€§** | ä½ | é«˜ (æ•…éšœéš”ç¦») |
| **æ€§èƒ½** | åŸºçº¿ | æå‡10-20% |
| **ç»´æŠ¤å¤æ‚åº¦** | ä½ | ä¸­ç­‰ |

---

## ğŸ¯ ä¸€é”®éƒ¨ç½² (æ¨è)

### æ­¥éª¤1: SSHè¿æ¥æœåŠ¡å™¨
```bash
ssh root@your-digitalocean-server-ip
```

### æ­¥éª¤2: è¿›å…¥é¡¹ç›®ç›®å½•
```bash
cd /path/to/chainreactions_backend_railway
```

### æ­¥éª¤3: æ‰§è¡Œéƒ¨ç½²è„šæœ¬
```bash
./deploy.sh
```

**å°±è¿™ä¹ˆç®€å•!** è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰æ­¥éª¤,åŒ…æ‹¬:
- âœ… ç¯å¢ƒæ£€æŸ¥
- âœ… è‡ªåŠ¨å¤‡ä»½
- âœ… åœæ­¢æ—§æœåŠ¡
- âœ… æ„å»ºæ–°é•œåƒ
- âœ… å¯åŠ¨å¾®æœåŠ¡
- âœ… å¥åº·éªŒè¯
- âœ… æ¸…ç†ä¼˜åŒ–

---

## ğŸ§ª éƒ¨ç½²åéªŒè¯

### è¿è¡Œæµ‹è¯•å¥—ä»¶
```bash
./test_deployment.sh
```

è¿™ä¼šæ‰§è¡Œå®Œæ•´çš„æµ‹è¯•,åŒ…æ‹¬:
- âœ… å®¹å™¨å¥åº·æ£€æŸ¥ (6é¡¹)
- âœ… APIç«¯ç‚¹æµ‹è¯• (5é¡¹)
- âœ… Redisè¿æ¥æµ‹è¯• (3é¡¹)
- âœ… ç½‘ç»œé€šä¿¡æµ‹è¯• (2é¡¹)
- âœ… èµ„æºä½¿ç”¨åˆ†æ
- âœ… æ—¥å¿—é”™è¯¯æ‰«æ
- âœ… APIåŠŸèƒ½æµ‹è¯• (2é¡¹)

**é¢„æœŸç»“æœ**: æ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…

---

## ğŸ“ éƒ¨ç½²æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶
| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `deploy.sh` | è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ |
| `test_deployment.sh` | å®Œæ•´æµ‹è¯•å¥—ä»¶ |
| `docker-compose.yml` | Docker Composeé…ç½® |
| `.env.docker.example` | ç¯å¢ƒå˜é‡æ¨¡æ¿ |
| `redis.conf` | Redisé…ç½®æ–‡ä»¶ |

### æ–‡æ¡£æ–‡ä»¶
| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `DOCKER_DEPLOYMENT.md` | Dockeréƒ¨ç½²å®Œæ•´æ–‡æ¡£ (700+è¡Œ) |
| `DEPLOYMENT_QUICK_REFERENCE.md` | å¿«é€Ÿå‚è€ƒæŒ‡å— |
| `README_DEPLOYMENT.md` | æœ¬æ–‡ä»¶ |

---

## ğŸ”§ æ‰‹åŠ¨éƒ¨ç½² (é«˜çº§ç”¨æˆ·)

å¦‚æœä½ éœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶:

### 1. å¤‡ä»½
```bash
BACKUP_DIR="/root/backups/chainreactions_$(date +%Y%m%d_%H%M%S)"
mkdir -p "$BACKUP_DIR"
cp .env "$BACKUP_DIR/"
docker-compose logs > "$BACKUP_DIR/logs.txt"
```

### 2. åœæ­¢æ—§æœåŠ¡
```bash
docker-compose down
```

### 3. æ‹‰å–ä»£ç 
```bash
git pull origin main
```

### 4. æ„å»ºé•œåƒ
```bash
docker-compose build --parallel
```

### 5. å¯åŠ¨æœåŠ¡
```bash
docker-compose up -d
```

### 6. éªŒè¯å¥åº·
```bash
sleep 60
docker-compose ps
curl http://localhost:3002/api/health
curl http://localhost:3003/api/health
curl http://localhost:3004/api/health
curl http://localhost:3005/api/health
curl http://localhost:3006/api/health
```

---

## ğŸš¨ æ•…éšœæ’æŸ¥é€ŸæŸ¥è¡¨

### é—®é¢˜: æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹æ—¥å¿—
docker-compose logs entity-relations

# æ£€æŸ¥ç¯å¢ƒå˜é‡
docker-compose config

# é‡æ–°æ„å»º
docker-compose up -d --build entity-relations
```

### é—®é¢˜: Redisè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥Redis
docker-compose logs redis
docker-compose exec redis redis-cli ping

# é‡å¯Redis
docker-compose restart redis
```

### é—®é¢˜: ç«¯å£å†²çª
```bash
# æ£€æŸ¥ç«¯å£
netstat -tulpn | grep 3002

# åœæ­¢å†²çªè¿›ç¨‹
docker-compose down
docker-compose up -d
```

### é—®é¢˜: å†…å­˜ä¸è¶³
```bash
# æŸ¥çœ‹ä½¿ç”¨æƒ…å†µ
docker stats

# æ¸…ç†ç¼“å­˜
docker-compose exec redis redis-cli FLUSHDB
docker-compose restart
```

---

## ğŸ”„ å¿«é€Ÿå›æ»š

å¦‚æœéƒ¨ç½²å‡ºç°é—®é¢˜:

```bash
# åœæ­¢æ–°ç‰ˆæœ¬
docker-compose down

# æ¢å¤å¤‡ä»½
BACKUP_DIR="/root/backups/chainreactions_YYYYMMDD_HHMMSS"
cp "$BACKUP_DIR/.env" .env

# å›é€€ä»£ç (å¦‚æœéœ€è¦)
git checkout <previous-commit>

# é‡æ–°å¯åŠ¨
docker-compose up -d --build
```

---

## ğŸ“Š å¾®æœåŠ¡æ¶æ„è¯¦æƒ…

### æœåŠ¡æ¸…å•

| æœåŠ¡åç§° | ç«¯å£ | åŠŸèƒ½æè¿° | ä¾èµ– |
|---------|------|---------|------|
| **Entity Relations** | 3002 | DeepThinking OSINT + æ™®é€šæœç´¢ | Gemini AI, Bright Data, Redis |
| **Entity Search** | 3003 | Linkupä¸šåŠ¡æƒ…æŠ¥æœç´¢ | Linkup API, Redis |
| **Dataset Matching** | 3004 | é«˜çº§å®ä½“åŒ¹é…ç®—æ³• | Supabase, Redis |
| **Data Management** | 3005 | CSVå¤„ç† & æ•°æ®ç®¡ç† | Supabase |
| **Dataset Search** | 3006 | SSEæµå¼æœç´¢ + NROæ•°æ® | Linkup API, Supabase, Redis |
| **Redis** | 6379 | å…±äº«ç¼“å­˜å±‚ | - |

### æœåŠ¡é—´ä¾èµ–å…³ç³»
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯åº”ç”¨ (Frontend)                       â”‚
â”‚                  (ç›´æ¥è¿æ¥åˆ°å„ä¸ªå¾®æœåŠ¡)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                   â”‚                   â”‚
          â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Entity Relationsâ”‚  â”‚  Entity Search  â”‚  â”‚Dataset Matching â”‚
â”‚   Port 3002     â”‚  â”‚   Port 3003     â”‚  â”‚   Port 3004     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚                     â”‚
         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
         â”‚         â”‚          â”‚          â”‚          â”‚
         â–¼         â–¼          â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data Management â”‚  â”‚ Dataset Search  â”‚  â”‚  Redis Cache    â”‚
â”‚   Port 3005     â”‚  â”‚   Port 3006     â”‚  â”‚  Port 6379      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰
- [ ] å·²å¤‡ä»½å½“å‰.envæ–‡ä»¶
- [ ] å·²å¤‡ä»½å½“å‰æ•°æ®å·
- [ ] å·²ç¡®è®¤æ‰€æœ‰APIå¯†é’¥å¯ç”¨
- [ ] å·²é€šçŸ¥å›¢é˜Ÿæˆå‘˜å³å°†éƒ¨ç½²
- [ ] æœåŠ¡å™¨æœ‰è¶³å¤Ÿç£ç›˜ç©ºé—´ (>10GB)
- [ ] æœåŠ¡å™¨æœ‰è¶³å¤Ÿå†…å­˜ (>2GB)

### éƒ¨ç½²ä¸­
- [ ] éƒ¨ç½²è„šæœ¬æ‰§è¡Œæ— é”™è¯¯
- [ ] æ‰€æœ‰é•œåƒæ„å»ºæˆåŠŸ
- [ ] æ‰€æœ‰å®¹å™¨å¯åŠ¨æˆåŠŸ
- [ ] å¥åº·æ£€æŸ¥å…¨éƒ¨é€šè¿‡

### éƒ¨ç½²å
- [ ] è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯
- [ ] æ£€æŸ¥æ‰€æœ‰APIç«¯ç‚¹å¯è®¿é—®
- [ ] éªŒè¯Redisè¿æ¥æ­£å¸¸
- [ ] ç›‘æ§èµ„æºä½¿ç”¨åœ¨æ­£å¸¸èŒƒå›´
- [ ] å‰ç«¯å¯ä»¥æ­£å¸¸è°ƒç”¨åç«¯API
- [ ] æ›´æ–°å‰ç«¯é…ç½®æŒ‡å‘æ–°ç«¯å£

---

## ğŸ“ˆ æ€§èƒ½é¢„æœŸ

### å¯åŠ¨æ—¶é—´
- é¦–æ¬¡æ„å»º: 5-10åˆ†é’Ÿ
- æœåŠ¡å¯åŠ¨: 60ç§’å†…
- å¥åº·æ£€æŸ¥: æ‰€æœ‰æœåŠ¡åœ¨40ç§’å†…å˜ä¸ºhealthy

### èµ„æºå ç”¨
- æ€»å†…å­˜: < 2GB
- ç£ç›˜ç©ºé—´: < 5GB
- CPU: ä¸­ä½å ç”¨ (< 30%)

### å“åº”æ—¶é—´
- å¥åº·æ£€æŸ¥: < 100ms
- APIè°ƒç”¨: < 2ç§’ (å–å†³äºä¸šåŠ¡é€»è¾‘)
- Redisç¼“å­˜: < 10ms

---

## ğŸ”’ ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–å»ºè®®

### 1. å®‰å…¨åŠ å›º
```bash
# ç§»é™¤Rediså¤–éƒ¨ç«¯å£æš´éœ²
# åœ¨docker-compose.ymlä¸­æ³¨é‡Šæ‰ ports: - "6379:6379"

# è®¾ç½®Rediså¯†ç 
# åœ¨redis.confä¸­è®¾ç½® requirepass your_strong_password
```

### 2. èµ„æºé™åˆ¶
```yaml
# åœ¨docker-compose.ymlä¸­ä¸ºæ¯ä¸ªæœåŠ¡æ·»åŠ 
deploy:
  resources:
    limits:
      cpus: '1.0'
      memory: 512M
```

### 3. æ—¥å¿—ç®¡ç†
```yaml
# åœ¨docker-compose.ymlä¸­æ·»åŠ 
logging:
  driver: "json-file"
  options:
    max-size: "10m"
    max-file: "3"
```

### 4. è‡ªåŠ¨é‡å¯
```yaml
# å·²é…ç½®
restart: unless-stopped
```

---

## ğŸ“ éœ€è¦å¸®åŠ©?

### å¸¸è§é—®é¢˜
1. **éƒ¨ç½²å¤±è´¥**: æ£€æŸ¥ `deploy.sh` è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
2. **æµ‹è¯•ä¸é€šè¿‡**: è¿è¡Œ `docker-compose logs [service-name]` æŸ¥çœ‹å…·ä½“æœåŠ¡æ—¥å¿—
3. **æ€§èƒ½é—®é¢˜**: è¿è¡Œ `docker stats` æŸ¥çœ‹èµ„æºä½¿ç”¨
4. **APIé”™è¯¯**: æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®å’ŒAPIå¯†é’¥æœ‰æ•ˆæ€§

### è·å–è¯¦ç»†æ–‡æ¡£
- **å®Œæ•´éƒ¨ç½²æŒ‡å—**: `DOCKER_DEPLOYMENT.md` (700+è¡Œ)
- **å¿«é€Ÿå‚è€ƒ**: `DEPLOYMENT_QUICK_REFERENCE.md`
- **Dockeré…ç½®**: `docker-compose.yml`

### æ”¶é›†è¯Šæ–­ä¿¡æ¯
```bash
# ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
docker-compose ps > diagnosis.txt
docker-compose logs >> diagnosis.txt
docker stats --no-stream >> diagnosis.txt
docker system df >> diagnosis.txt
```

---

## ğŸ‰ éƒ¨ç½²æˆåŠŸåçš„ä¸‹ä¸€æ­¥

1. âœ… **æ›´æ–°å‰ç«¯é…ç½®**
   - ä¿®æ”¹APIç«¯ç‚¹ä» `localhost:3000` åˆ° `localhost:3002-3006`
   - å‚è€ƒå‰ç«¯æ–‡æ¡£è¿›è¡Œé…ç½®

2. âœ… **é…ç½®åå‘ä»£ç†**
   - å¦‚ä½¿ç”¨Nginx/CloudFlare,é…ç½®è·¯ç”±è§„åˆ™
   - æ˜ å°„åŸŸååˆ°ä¸åŒå¾®æœåŠ¡ç«¯å£

3. âœ… **è®¾ç½®ç›‘æ§å‘Šè­¦**
   - é…ç½®å¥åº·æ£€æŸ¥ç›‘æ§
   - è®¾ç½®èµ„æºä½¿ç”¨å‘Šè­¦é˜ˆå€¼

4. âœ… **å®šæœŸå¤‡ä»½**
   - è®¾ç½®cronä»»åŠ¡è‡ªåŠ¨å¤‡ä»½Redisæ•°æ®
   - å¤‡ä»½ä¸Šä¼ æ–‡ä»¶å’Œé…ç½®

5. âœ… **å›¢é˜ŸåŸ¹è®­**
   - åˆ†äº«å¾®æœåŠ¡æ¶æ„æ–‡æ¡£
   - åŸ¹è®­å›¢é˜Ÿä½¿ç”¨æ–°çš„ç®¡ç†å‘½ä»¤

---

**ç‰ˆæœ¬**: 4.0.0 (å¾®æœåŠ¡æ¶æ„)
**æ›´æ–°æ—¥æœŸ**: 2025å¹´10æœˆ20æ—¥
**éƒ¨ç½²ç›®æ ‡**: DigitalOcean Docker

**ç¥éƒ¨ç½²é¡ºåˆ©!** ğŸš€
