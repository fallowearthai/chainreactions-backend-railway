# ğŸ¯ ChainReactions Backend - éƒ¨ç½²å°±ç»ªæ€»ç»“

> **æ‰€æœ‰éƒ¨ç½²æ–‡ä»¶å·²å‡†å¤‡å®Œæ¯•,å¯ä»¥ç«‹å³åœ¨DigitalOceanæœåŠ¡å™¨ä¸Šæ‰§è¡Œéƒ¨ç½²**

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. ä»£ç åŒæ­¥ âœ…
- [x] ä»å¼€å‘ç‰ˆæœ¬å®Œæ•´åŒæ­¥åˆ°ç”Ÿäº§ä»“åº“
- [x] 5ä¸ªå¾®æœåŠ¡ç›®å½•å®Œæ•´è¿ç§»
- [x] æ‰€æœ‰Dockerfileå’Œé…ç½®æ–‡ä»¶å·²å°±ä½
- [x] Gitæäº¤å¹¶æ¨é€åˆ°è¿œç¨‹ä»“åº“

### 2. Dockeré…ç½® âœ…
- [x] `docker-compose.yml` - å®Œæ•´çš„å¾®æœåŠ¡ç¼–æ’é…ç½®
- [x] `redis.conf` - Redisç¼“å­˜é…ç½®
- [x] `.env.docker.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿
- [x] 5ä¸ªæœåŠ¡çš„`.dockerignore` æ–‡ä»¶

### 3. éƒ¨ç½²è‡ªåŠ¨åŒ– âœ…
- [x] `deploy.sh` - ä¸€é”®è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ (330è¡Œ)
- [x] `test_deployment.sh` - å®Œæ•´æµ‹è¯•å¥—ä»¶ (350è¡Œ)
- [x] è„šæœ¬å·²æ·»åŠ æ‰§è¡Œæƒé™

### 4. æ–‡æ¡£å®Œå–„ âœ…
- [x] `DOCKER_DEPLOYMENT.md` - å®Œæ•´éƒ¨ç½²æ–‡æ¡£ (700+è¡Œ)
- [x] `DEPLOYMENT_QUICK_REFERENCE.md` - å¿«é€Ÿå‚è€ƒ (300+è¡Œ)
- [x] `README_DEPLOYMENT.md` - éƒ¨ç½²æŒ‡å— (400+è¡Œ)
- [x] `DEPLOYMENT_SUMMARY.md` - æœ¬æ–‡ä»¶

---

## ğŸš€ å¦‚ä½•åœ¨DigitalOceanæœåŠ¡å™¨ä¸Šéƒ¨ç½²

### è¶…çº§ç®€å•çš„3æ­¥éƒ¨ç½²:

```bash
# ç¬¬1æ­¥: SSHè¿æ¥åˆ°æœåŠ¡å™¨
ssh root@your-server-ip

# ç¬¬2æ­¥: è¿›å…¥é¡¹ç›®ç›®å½•å¹¶æ‹‰å–æœ€æ–°ä»£ç 
cd /path/to/chainreactions_backend_railway
git pull origin main

# ç¬¬3æ­¥: æ‰§è¡Œä¸€é”®éƒ¨ç½²
./deploy.sh
```

**å°±è¿™ä¹ˆç®€å•!** æ•´ä¸ªè¿‡ç¨‹çº¦20-30åˆ†é’Ÿ,åœæœºæ—¶é—´ä»…2-5åˆ†é’Ÿã€‚

---

## ğŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

åœ¨æ‰§è¡Œéƒ¨ç½²å‰,è¯·ç¡®è®¤:

- [ ] âœ… ä½ æœ‰DigitalOceanæœåŠ¡å™¨çš„SSHè®¿é—®æƒé™
- [ ] âœ… æœåŠ¡å™¨ä¸Šå·²å®‰è£…Dockerå’ŒDocker Compose
- [ ] âœ… æœåŠ¡å™¨æœ‰è¶³å¤Ÿçš„èµ„æº (>2GBå†…å­˜, >10GBç£ç›˜)
- [ ] âœ… ç°æœ‰çš„`.env`æ–‡ä»¶åŒ…å«æ‰€æœ‰å¿…éœ€çš„APIå¯†é’¥
- [ ] âœ… å·²é€šçŸ¥å›¢é˜Ÿæˆå‘˜å³å°†è¿›è¡Œéƒ¨ç½²
- [ ] âœ… å·²å‡†å¤‡å¥½å›æ»šæ–¹æ¡ˆ(è‡ªåŠ¨å¤‡ä»½ä¼šå¤„ç†)

---

## ğŸ¯ éƒ¨ç½²è„šæœ¬åŠŸèƒ½è¯¦è§£

### `deploy.sh` è‡ªåŠ¨å®Œæˆä»¥ä¸‹ä»»åŠ¡:

#### é˜¶æ®µ1: ç¯å¢ƒæ£€æŸ¥
- âœ… éªŒè¯Dockerå’ŒDocker Composeå·²å®‰è£…
- âœ… æ£€æŸ¥`.env`æ–‡ä»¶æ˜¯å¦å­˜åœ¨
- âœ… éªŒè¯æ‰€æœ‰å¿…éœ€çš„APIå¯†é’¥å·²é…ç½®

#### é˜¶æ®µ2: è‡ªåŠ¨å¤‡ä»½
- âœ… åˆ›å»ºå¸¦æ—¶é—´æˆ³çš„å¤‡ä»½ç›®å½•
- âœ… å¤‡ä»½`.env`æ–‡ä»¶
- âœ… å¤‡ä»½å½“å‰å®¹å™¨æ—¥å¿—
- âœ… å¤‡ä»½Redisæ•°æ®
- âœ… å¤‡ä»½ä¸Šä¼ æ–‡ä»¶

#### é˜¶æ®µ3: åœæ­¢æ—§æœåŠ¡
- âœ… ä¼˜é›…åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨
- âœ… é‡Šæ”¾ç«¯å£èµ„æº

#### é˜¶æ®µ4: æ‹‰å–æœ€æ–°ä»£ç 
- âœ… ä»Gitä»“åº“æ‹‰å–æœ€æ–°ä»£ç 
- âœ… ç¡®ä¿æ‰€æœ‰æ–‡ä»¶éƒ½æ˜¯æœ€æ–°ç‰ˆæœ¬

#### é˜¶æ®µ5: æ„å»ºDockeré•œåƒ
- âœ… å¹¶è¡Œæ„å»ºæ‰€æœ‰5ä¸ªå¾®æœåŠ¡é•œåƒ
- âœ… ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºä¼˜åŒ–é•œåƒå¤§å°
- âœ… é¢„è®¡æ—¶é—´: 5-10åˆ†é’Ÿ(é¦–æ¬¡æ„å»º)

#### é˜¶æ®µ6: å¯åŠ¨å¾®æœåŠ¡
- âœ… æŒ‰ä¾èµ–é¡ºåºå¯åŠ¨æ‰€æœ‰æœåŠ¡
- âœ… Redisé¦–å…ˆå¯åŠ¨å¹¶å¥åº·æ£€æŸ¥é€šè¿‡
- âœ… å…¶ä»–æœåŠ¡ä¾æ¬¡å¯åŠ¨

#### é˜¶æ®µ7: å¥åº·æ£€æŸ¥
- âœ… ç­‰å¾…60ç§’è®©æœåŠ¡å®Œå…¨å¯åŠ¨
- âœ… æ£€æŸ¥æ‰€æœ‰å®¹å™¨çŠ¶æ€
- âœ… æµ‹è¯•æ¯ä¸ªæœåŠ¡çš„å¥åº·ç«¯ç‚¹
- âœ… éªŒè¯Redisè¿æ¥

#### é˜¶æ®µ8: éƒ¨ç½²æ€»ç»“
- âœ… æ˜¾ç¤ºéƒ¨ç½²ç»“æœå’ŒçŠ¶æ€
- âœ… åˆ—å‡ºæ‰€æœ‰æœåŠ¡URL
- âœ… æä¾›æ•…éšœæ’æŸ¥å»ºè®®(å¦‚æœ‰å¤±è´¥)

#### é˜¶æ®µ9: èµ„æºç›‘æ§
- âœ… æ˜¾ç¤ºå®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
- âœ… å¸®åŠ©è¯†åˆ«æ½œåœ¨é—®é¢˜

#### é˜¶æ®µ10: æ¸…ç†ä¼˜åŒ–
- âœ… åˆ é™¤æœªä½¿ç”¨çš„Dockeré•œåƒ
- âœ… é‡Šæ”¾ç£ç›˜ç©ºé—´

---

## ğŸ§ª æµ‹è¯•è„šæœ¬åŠŸèƒ½è¯¦è§£

### `test_deployment.sh` æ‰§è¡Œ9ä¸ªæµ‹è¯•å¥—ä»¶:

1. **å®¹å™¨å¥åº·æ£€æŸ¥** - éªŒè¯æ‰€æœ‰å®¹å™¨è¿è¡ŒçŠ¶æ€
2. **å¥åº·ç«¯ç‚¹æµ‹è¯•** - æµ‹è¯•5ä¸ªå¾®æœåŠ¡çš„å¥åº·API
3. **Redisè¿æ¥æµ‹è¯•** - éªŒè¯Redis PINGã€å†…å­˜ã€å®¢æˆ·ç«¯
4. **æœåŠ¡ä¿¡æ¯ç«¯ç‚¹** - æµ‹è¯•æ‰€æœ‰æœåŠ¡çš„info API
5. **ç½‘ç»œè¿é€šæ€§** - æµ‹è¯•æœåŠ¡é—´ç½‘ç»œé€šä¿¡
6. **èµ„æºä½¿ç”¨åˆ†æ** - ç›‘æ§CPUã€å†…å­˜ã€ç£ç›˜
7. **æ—¥å¿—é”™è¯¯æ‰«æ** - æ£€æŸ¥æœ€è¿‘100è¡Œæ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
8. **æ•°æ®å·éªŒè¯** - éªŒè¯Rediså’Œä¸Šä¼ æ–‡ä»¶å·å­˜åœ¨
9. **APIåŠŸèƒ½æµ‹è¯•** - æµ‹è¯•å…³é”®APIç«¯ç‚¹å“åº”

**é¢„æœŸç»“æœ**: æ‰€æœ‰æµ‹è¯•é€šè¿‡ âœ…

---

## ğŸ“Š éƒ¨ç½²åçš„æ¶æ„

### å¾®æœåŠ¡æ¶æ„æ¦‚è§ˆ
```
æœåŠ¡å™¨ (DigitalOcean Docker)
â”œâ”€â”€ Entity Relations    (Port 3002) - DeepThinking OSINT
â”œâ”€â”€ Entity Search       (Port 3003) - Linkupä¸šåŠ¡æƒ…æŠ¥
â”œâ”€â”€ Dataset Matching    (Port 3004) - å®ä½“åŒ¹é…ç®—æ³•
â”œâ”€â”€ Data Management     (Port 3005) - CSVå¤„ç†
â”œâ”€â”€ Dataset Search      (Port 3006) - SSEæµå¼æœç´¢
â””â”€â”€ Redis Cache         (Port 6379) - å…±äº«ç¼“å­˜
```

### ç«¯å£æ˜ å°„
| æœåŠ¡ | å®¹å™¨ç«¯å£ | ä¸»æœºç«¯å£ |
|------|---------|---------|
| Entity Relations | 3002 | 3002 |
| Entity Search | 3003 | 3003 |
| Dataset Matching | 3004 | 3004 |
| Data Management | 3005 | 3005 |
| Dataset Search | 3006 | 3006 |
| Redis | 6379 | 6379 |

---

## ğŸ”§ éƒ¨ç½²åéœ€è¦åšçš„äº‹

### 1. ç«‹å³éªŒè¯ (éƒ¨ç½²å®Œæˆå)
```bash
# è¿è¡Œæµ‹è¯•å¥—ä»¶
./test_deployment.sh

# æ‰‹åŠ¨æ£€æŸ¥å…³é”®æœåŠ¡
curl http://localhost:3002/api/health
curl http://localhost:3003/api/health
curl http://localhost:3004/api/health
curl http://localhost:3005/api/health
curl http://localhost:3006/api/health
```

### 2. æ›´æ–°å‰ç«¯é…ç½® (å¿…é¡»)
å‰ç«¯éœ€è¦æ›´æ–°APIç«¯ç‚¹é…ç½®:

```typescript
// æ—§é…ç½® (å•ä½“æ¶æ„)
const API_BASE_URL = 'http://your-server:3000';

// æ–°é…ç½® (å¾®æœåŠ¡æ¶æ„)
const BACKEND_SERVICES = {
  entityRelations: 'http://your-server:3002',
  entitySearch: 'http://your-server:3003',
  datasetMatching: 'http://your-server:3004',
  dataManagement: 'http://your-server:3005',
  datasetSearch: 'http://your-server:3006'
};
```

### 3. é…ç½®åå‘ä»£ç† (å¯é€‰ä½†æ¨è)
å¦‚æœä½¿ç”¨Nginxæˆ–CloudFlare:

```nginx
# Nginxç¤ºä¾‹é…ç½®
location /api/entity-relations/ {
    proxy_pass http://localhost:3002/;
}

location /api/entity-search/ {
    proxy_pass http://localhost:3003/;
}

# ... å…¶ä»–æœåŠ¡ç±»ä¼¼
```

### 4. è®¾ç½®ç›‘æ§å‘Šè­¦ (æ¨è)
- é…ç½®å¥åº·æ£€æŸ¥ç›‘æ§ (æ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡)
- è®¾ç½®å†…å­˜ä½¿ç”¨å‘Šè­¦ (> 80%)
- è®¾ç½®ç£ç›˜ç©ºé—´å‘Šè­¦ (> 90%)
- é…ç½®é”™è¯¯æ—¥å¿—å‘Šè­¦

### 5. å®šæœŸå¤‡ä»½ (æ¨è)
```bash
# æ·»åŠ åˆ°crontab,æ¯å¤©å‡Œæ™¨3ç‚¹å¤‡ä»½
0 3 * * * cd /path/to/project && docker-compose exec redis redis-cli BGSAVE && \
  docker cp chainreactions-redis:/data/dump.rdb /backup/redis-$(date +\%Y\%m\%d).rdb
```

---

## ğŸš¨ å¦‚æœé‡åˆ°é—®é¢˜

### éƒ¨ç½²å¤±è´¥
```bash
# æŸ¥çœ‹éƒ¨ç½²è„šæœ¬è¾“å‡ºçš„å…·ä½“é”™è¯¯
# é€šå¸¸ä¼šæŒ‡å‡ºå“ªä¸ªæœåŠ¡æˆ–å“ªä¸ªæ­¥éª¤å¤±è´¥äº†

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„æ—¥å¿—
docker-compose logs entity-relations
docker-compose logs entity-search

# é‡å¯å¤±è´¥çš„æœåŠ¡
docker-compose restart entity-relations
```

### æµ‹è¯•ä¸é€šè¿‡
```bash
# æŸ¥çœ‹æµ‹è¯•è„šæœ¬çš„è¯¦ç»†è¾“å‡º
# å®ƒä¼šå‘Šè¯‰ä½ å“ªäº›æµ‹è¯•å¤±è´¥äº†

# æŸ¥çœ‹å¤±è´¥æœåŠ¡çš„æ—¥å¿—
docker-compose logs -f [service-name]

# æ£€æŸ¥ç¯å¢ƒå˜é‡
docker-compose config
```

### æ€§èƒ½é—®é¢˜
```bash
# ç›‘æ§èµ„æºä½¿ç”¨
docker stats

# æ£€æŸ¥Rediså†…å­˜
docker-compose exec redis redis-cli info memory

# æ¸…ç†ç¼“å­˜
docker-compose exec redis redis-cli FLUSHDB
```

### éœ€è¦å›æ»š
```bash
# åœæ­¢æ–°ç‰ˆæœ¬
docker-compose down

# æŸ¥æ‰¾æœ€è¿‘çš„å¤‡ä»½
ls -lh /root/backups/

# æ¢å¤.env
BACKUP_DIR="/root/backups/chainreactions_20251020_HHMMSS"
cp "$BACKUP_DIR/.env.backup" .env

# å›é€€ä»£ç 
git log  # æ‰¾åˆ°ä¹‹å‰çš„commit
git checkout <previous-commit>

# é‡æ–°éƒ¨ç½²
docker-compose up -d --build
```

---

## ğŸ“ˆ é¢„æœŸæ€§èƒ½æŒ‡æ ‡

### å¯åŠ¨æ—¶é—´
- **é•œåƒæ„å»º**: 5-10åˆ†é’Ÿ (é¦–æ¬¡) / 1-2åˆ†é’Ÿ (æ›´æ–°)
- **æœåŠ¡å¯åŠ¨**: 60ç§’å†…å…¨éƒ¨å¯åŠ¨
- **å¥åº·æ£€æŸ¥**: 40ç§’å†…å…¨éƒ¨å˜ä¸ºhealthy
- **æ€»åœæœºæ—¶é—´**: 2-5åˆ†é’Ÿ

### èµ„æºå ç”¨
- **æ€»å†…å­˜**: < 2GB (æ‰€æœ‰å®¹å™¨)
- **ç£ç›˜ç©ºé—´**: < 5GB (é•œåƒ+æ•°æ®)
- **CPU**: ä¸­ä½å ç”¨ (< 30%)

### APIæ€§èƒ½
- **å¥åº·æ£€æŸ¥**: < 100ms
- **ç®€å•API**: < 500ms
- **å¤æ‚æŸ¥è¯¢**: < 2ç§’
- **Redisç¼“å­˜**: < 10ms

---

## ğŸ“š å®Œæ•´æ–‡æ¡£ç´¢å¼•

### æ ¸å¿ƒæ–‡æ¡£
1. **`README_DEPLOYMENT.md`** - ä¸»è¦éƒ¨ç½²æŒ‡å—
   - ä¸€é”®éƒ¨ç½²è¯´æ˜
   - æ¶æ„å¯¹æ¯”
   - æ£€æŸ¥æ¸…å•
   - æ•…éšœæ’æŸ¥

2. **`DOCKER_DEPLOYMENT.md`** - å®Œæ•´Dockeræ–‡æ¡£
   - è¯¦ç»†é…ç½®è¯´æ˜
   - æ‰€æœ‰ç®¡ç†å‘½ä»¤
   - å®‰å…¨å»ºè®®
   - æ€§èƒ½ä¼˜åŒ–

3. **`DEPLOYMENT_QUICK_REFERENCE.md`** - å¿«é€Ÿå‚è€ƒ
   - å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥
   - æ•…éšœæ’æŸ¥é€ŸæŸ¥è¡¨
   - æ€§èƒ½ç›‘æ§å‘½ä»¤

4. **`DEPLOYMENT_SUMMARY.md`** - æœ¬æ–‡ä»¶
   - éƒ¨ç½²å°±ç»ªæ€»ç»“
   - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—

### é…ç½®æ–‡ä»¶
- `docker-compose.yml` - Dockerç¼–æ’é…ç½®
- `redis.conf` - Redisé…ç½®
- `.env.docker.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿

### è„šæœ¬æ–‡ä»¶
- `deploy.sh` - è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- `test_deployment.sh` - æµ‹è¯•å¥—ä»¶è„šæœ¬

---

## âœ… æœ€ç»ˆç¡®è®¤

åœ¨æ‰§è¡Œéƒ¨ç½²å‰,è¯·å†æ¬¡ç¡®è®¤:

- [x] âœ… æ‰€æœ‰ä»£ç å·²åŒæ­¥åˆ°ç”Ÿäº§ä»“åº“
- [x] âœ… Dockeré…ç½®æ–‡ä»¶å®Œæ•´
- [x] âœ… éƒ¨ç½²è„šæœ¬å·²å°±ç»ªå¹¶æµ‹è¯•é€šè¿‡
- [x] âœ… æµ‹è¯•è„šæœ¬å·²å°±ç»ª
- [x] âœ… æ–‡æ¡£å®Œå–„
- [x] âœ… å·²æ¨é€åˆ°Gitè¿œç¨‹ä»“åº“

**ä½ å·²ç»å‡†å¤‡å¥½è¿›è¡Œéƒ¨ç½²äº†!** ğŸ‰

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ (åœ¨DigitalOceanæœåŠ¡å™¨ä¸Š):
```bash
ssh root@your-server-ip
cd /path/to/chainreactions_backend_railway
git pull origin main
./deploy.sh
```

### éƒ¨ç½²åæ‰§è¡Œ:
```bash
./test_deployment.sh
```

### ç„¶å:
1. æ›´æ–°å‰ç«¯é…ç½®
2. é…ç½®åå‘ä»£ç†
3. è®¾ç½®ç›‘æ§å‘Šè­¦
4. äº«å—æ–°çš„å¾®æœåŠ¡æ¶æ„å¸¦æ¥çš„æ€§èƒ½æå‡! ğŸš€

---

**ç¥éƒ¨ç½²é¡ºåˆ©!**

å¦‚æœ‰ä»»ä½•é—®é¢˜,è¯·å‚è€ƒå®Œæ•´æ–‡æ¡£æˆ–æŸ¥çœ‹éƒ¨ç½²è„šæœ¬çš„è¯¦ç»†è¾“å‡ºã€‚

**æœ€åæ›´æ–°**: 2025å¹´10æœˆ20æ—¥
**æ¶æ„ç‰ˆæœ¬**: 4.0.0 (å¾®æœåŠ¡æ¶æ„)
**Git Commit**: 9e22c4aa
